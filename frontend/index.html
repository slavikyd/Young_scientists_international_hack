<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä GlobalCertHub</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Geologica:wght@100;300;400;500;600;700;900&display=swap">
    <link rel="stylesheet" href="styles/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
</head>
<body>
    <!-- Sticky Header -->
    <header class="header-bar">
        <div class="header-container">
            <button class="header-logo-btn" title="–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è">üìã</button>
            <div class="header-spacer"></div>
            <div class="language-selector">
                <button class="lang-btn active" data-lang="ru">RU</button>
                <span class="lang-divider">|</span>
                <button class="lang-btn" data-lang="en">EN</button>
            </div>
        </div>
    </header>

    <div class="main-container">
        <div class="page-header">
            <h1>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä GlobalCertHub</h1>
            <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, —É–ø—Ä–∞–≤–ª—è–π—Ç–µ —à–∞–±–ª–æ–Ω–∞–º–∏ –∏ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã</p>
        </div>

        <!-- Step Navigation -->
        <div class="step-navigation">
            <button class="step-btn active" data-step="upload">
                <span class="step-icon">üì•</span>
                <span class="step-label">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞</span>
            </button>
            <span class="step-arrow">‚Üí</span>
            <button class="step-btn disabled" data-step="templates">
                <span class="step-icon">üìã</span>
                <span class="step-label">–í—ã–±–æ—Ä —à–∞–±–ª–æ–Ω–∞</span>
            </button>
            <span class="step-arrow">‚Üí</span>
            <button class="step-btn disabled" data-step="generate">
                <span class="step-icon">‚≠ê</span>
                <span class="step-label">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è</span>
            </button>
        </div>

        <!-- Content Pages -->
        <div class="pages-container">
            <!-- Page 1: Upload -->
            <div class="page active" id="upload-page" data-page="upload">
                <div class="page-content">
                    <div class="page-header-title">
                        <h2>–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞</h2>
                        <button class="delete-btn hidden" id="clearUploadBtn" title="–û—á–∏—Å—Ç–∏—Ç—å">üóëÔ∏è</button>
                    </div>

                    <div class="upload-area" id="uploadArea">
                        <div class="upload-icon">üìÑ</div>
                        <div class="upload-text">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª</div>
                        <div class="upload-subtext">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å—é–¥–∞ —Ñ–∞–π–ª –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –µ–≥–æ, –Ω–∞–∂–∞–≤ –Ω–∞ –æ–±–ª–∞—Å—Ç—å</div>
                    </div>

                    <div id="uploadStatus" class="upload-status hidden"></div>

                    <div id="filePreviewSection" class="file-preview-section hidden">
                        <div class="file-info">
                            <span id="fileName" class="file-name"></span>
                        </div>
                        <table id="participantsPreview" class="preview-table">
                            <thead>
                                <tr>
                                    <th>–§–ò–û</th>
                                    <th>–ü–æ—á—Ç–∞</th>
                                    <th>–†–æ–ª—å</th>
                                    <th>–ú–µ—Å—Ç–æ</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                        <div id="fileStats" class="file-stats"></div>
                    </div>

                    <div class="download-template-buttons">
                        <span class="template-label">–ü—Ä–∏–º–µ—Ä –∑–∞–≥—Ä—É–∂–∞–µ–º–æ–π —Ç–∞–±–ª–∏—Ü—ã</span>
                        <button class="btn btn-download" id="downloadXlsx">
                            <span>.XLSX</span>
                        </button>
                        <button class="btn btn-download" id="downloadCsv">
                            <span>.CSV</span>
                        </button>
                    </div>

                    <div class="page-navigation">
                        <button class="btn btn-next" id="nextFromUpload" disabled>–î–∞–ª–µ–µ ‚Üí</button>
                    </div>

                    <div id="fileFormatInfo" class="file-format-info">
                        <h3>–¢—Ä–µ–±—É–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç CSV/XLSX:</h3>
                        <table class="format-table">
                            <thead>
                                <tr>
                                    <th>–§–ò–û</th>
                                    <th>–ü–æ—á—Ç–∞</th>
                                    <th>–†–æ–ª—å</th>
                                    <th>–ú–µ—Å—Ç–æ</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>–ü—É–ø–∫–∏–Ω –í–∞—Å–∏–ª–∏–π –ñ—ë–Ω–æ–≤–∏—á</td>
                                    <td>vasiliy@pupka.net</td>
                                    <td>–ü–æ–±–µ–¥–∏—Ç–µ–ª—å</td>
                                    <td>1</td>
                                </tr>
                                <tr>
                                    <td>–õ—é–±–æ–ø—ã—Ç–∫–∏–Ω–∞ –í–∞—Ä–≤–∞—Ä–∞ –ë–µ–∑–Ω–æ—Å–∞—è</td>
                                    <td>varvara@nosa.net</td>
                                    <td>–£—á–∞—Å—Ç–Ω–∏–∫</td>
                                    <td></td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="format-rules">
                            <p><strong>–î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —Ä–æ–ª–∏:</strong> <span id="rolesInfo">–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ</span></p>
                            <p><strong>–î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –º–µ—Å—Ç–∞:</strong> <span id="placesInfo">–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ</span></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Page 2: Templates -->
            <div class="page" id="templates-page" data-page="templates">
                <div class="page-content">
                    <div class="page-header-title">
                        <h2>–í—ã–±–æ—Ä —à–∞–±–ª–æ–Ω–∞</h2>
                        <button class="btn btn-add-template" id="addTemplateBtn">+ –î–æ–±–∞–≤–∏—Ç—å —à–∞–±–ª–æ–Ω</button>
                    </div>

                    <div id="templatesGrid" class="templates-grid"></div>

                    <div class="page-navigation">
                        <button class="btn btn-next" id="nextFromTemplates" disabled>–î–∞–ª–µ–µ ‚Üí</button>
                    </div>
                </div>
            </div>

            <!-- Page 3: Generate -->
            <div class="page" id="generate-page" data-page="generate">
                <div class="page-content">
                    <div class="page-header-title">
                        <h2>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è</h2>
                        <button class="btn btn-back hidden" id="restartBtn">‚Üê –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
                    </div>

                    <div class="settings-preview" id="settingsPreview">
                        <h3>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –Ω–∞—Å—Ç—Ä–æ–µ–∫</h3>
                        <div class="settings-list">
                            <div class="setting-item">
                                <span class="setting-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞</span>
                                <span class="setting-value" id="previewFileName">-</span>
                            </div>
                            <div class="setting-item">
                                <span class="setting-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤</span>
                                <span class="setting-value" id="previewCertCount">-</span>
                            </div>
                            <div class="setting-item">
                                <span class="setting-label">–ù–∞–∑–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞</span>
                                <span class="setting-value" id="previewTemplateName">-</span>
                            </div>
                            <div class="setting-item">
                                <span class="setting-label">–ü—Ä–æ–≤–æ–¥–∏—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="sendEmailToggle" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="setting-item hidden" id="recipientsCountItem">
                                <span class="setting-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π</span>
                                <div class="recipients-input-group">
                                    <input type="number" id="recipientsCountInput" min="0" value="90" class="recipients-input">
                                    <span class="recipients-display">/</span>
                                    <span class="setting-value" id="previewRecipients">90</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="generateStatus" class="generate-status hidden"></div>

                    <!-- PDF Viewer for Generated Certificates -->
                    <div id="pdfViewerContainer" class="pdf-viewer-container hidden">
                        <div class="pdf-viewer-header">
                            <h3>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞</h3>
                            <button class="modal-close pdf-viewer-close" id="closePdfViewer">‚úï</button>
                        </div>
                        <div id="pdfViewer" class="pdf-viewer">
                            <canvas id="pdfCanvas"></canvas>
                            <div style="padding: 10px; text-align: center; background-color: var(--color-border); display: flex; justify-content: space-between; align-items: center;">
                                <button class="btn btn-outline" id="pdfPrevBtn" style="padding: 6px 12px; font-size: 12px;">‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∞—è</button>
                                <span id="pdfPageInfo">1 / 1</span>
                                <button class="btn btn-outline" id="pdfNextBtn" style="padding: 6px 12px; font-size: 12px;">–°–ª–µ–¥—É—é—â–∞—è ‚Üí</button>
                            </div>
                        </div>
                        <div id="certificateHtmlPreview" class="pdf-viewer hidden" style="padding: 16px;">
                            <!-- HTML preview iframe will be injected here for HTML templates -->
                        </div>
                    </div>

                    <div style="display:flex; gap:12px; align-items:center; margin-top: 16px;">
                        <button class="btn btn-outline" id="prevRecipientBtn">‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∏–π —É—á–∞—Å—Ç–Ω–∏–∫</button>
                        <button class="btn btn-outline" id="nextRecipientBtn">–°–ª–µ–¥—É—é—â–∏–π —É—á–∞—Å—Ç–Ω–∏–∫ ‚Üí</button>
                        <div style="flex:1"></div>
                        <button class="btn btn-generate-full" id="generateBtn">–ù–∞—á–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Create/Edit Template -->
    <div id="templateModal" class="modal hidden">
        <div class="modal-backdrop" id="modalBackdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">–°–æ–∑–¥–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞</h3>
                <button class="modal-close" id="modalClose">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="templateName">–ù–∞–∑–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ *</label>
                    <input type="text" id="templateName" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, –ú–æ–π –∫—Ä–∞—Å–∏–≤—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="templateDesc">–û–ø–∏—Å–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞</label>
                        <input type="text" id="templateDesc" placeholder="–û–ø–∏—à–∏—Ç–µ –≤–∞—à —à–∞–±–ª–æ–Ω">
                    </div>
                    <div class="form-group">
                        <label>–¢–∏–ø —à–∞–±–ª–æ–Ω–∞</label>
                        <div class="template-type-display" id="templateTypeDisplay">HTML</div>
                    </div>
                </div>

                <div class="template-input-buttons" id="templateInputButtons">
                    <button class="btn btn-outline" id="chooseFileBtn">–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª</button>
                    <button class="btn btn-primary" id="insertCodeBtn">–í—Å—Ç–∞–≤–∏—Ç—å –∫–æ–¥</button>
                </div>

                <div id="fileUploadArea" class="file-upload-area">
                    <div class="upload-icon">üìÑ</div>
                    <div class="upload-text">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª</div>
                    <div class="upload-subtext">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å—é–¥–∞ —Ñ–∞–π–ª –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</div>
                    <div class="upload-formats">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: HTML, PDF</div>
                </div>

                <div id="codeEditorSection" class="code-editor-section hidden">
                    <div class="editor-container">
                        <textarea id="templateContent" class="code-editor" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ –∫–æ–¥ HTML..."></textarea>
                        <div id="templatePreview" class="template-preview">
                            <div class="preview-placeholder">–¢–£–¢ –ë–£–î–ï–¢ –ö–ê–ö–ê–Ø-–ù–ò–ë–£–î–¨ –ö–†–ê–°–ò–í–ê–Ø –ö–ê–†–¢–ò–ù–ö–ê –®–ê–ë–õ–û–ù–ê</div>
                            <button class="preview-expand-btn" id="expandPreviewBtn" title="–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å">üî≤</button>
                        </div>
                    </div>
                </div>

                <div id="loadedFileInfo" class="loaded-file-info hidden">
                    <div class="file-name-display" id="loadedFileName"></div>
                    <button class="btn btn-delete-file" id="deleteFileBtn">üóëÔ∏è</button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-cancel" id="modalCancel">–û—Ç–º–µ–Ω–∏—Ç—å</button>
                <button class="btn btn-save" id="modalSave">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Template Preview Fullscreen Modal -->
    <div id="previewModal" class="modal hidden">
        <div class="modal-backdrop" id="previewBackdrop"></div>
        <div class="modal-preview-content">
            <button class="modal-close" id="previewClose">‚úï</button>
            <div id="fullPreviewContainer" class="full-preview-container"></div>
        </div>
    </div>

    <!-- Hidden file inputs -->
    <input type="file" id="fileInput" accept=".csv,.xlsx" style="display: none;">
    <input type="file" id="templateFileInput" accept=".html,.pdf" style="display: none;">

    <!-- Scripts -->
    <script src="js/state.js"></script>
    <script src="js/api.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/upload.js"></script>
    <script src="js/templates.js"></script>
    <script src="js/generate.js"></script>
    <script src="js/pdf-viewer.js"></script>
    <script src="js/app.js"></script>
</body>
</html>